{% schema %}
{
  "name": "Product Arts Collection",
  "settings": [
    {
      "type": "collection",
      "id": "selected_collection",
      "label": "Select Collection"
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "text", "label": "Tab Text" },
        { "type": "url", "id": "url", "label": "Tab Link" },
        { "type": "checkbox", "id": "active", "label": "Set as Active" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Arts Collection",
      "blocks": [
        { "type": "tab", "settings": { "text": "All", "url": "#", "active": true } },
        { "type": "tab", "settings": { "text": "Range Rover", "url": "#", "active": false } },
        { "type": "tab", "settings": { "text": "Discovery", "url": "#", "active": false } },
        { "type": "tab", "settings": { "text": "Defender", "url": "#", "active": false } }
      ]
    }
  ]
}
{% endschema %}

{% assign collection = collections[section.settings.selected_collection] %}

<div class="page-width">
<div class="range-rover-section">

<!-- ================= FILTER BAR ================= -->

<div class="top-bar-filter desktop-filters">
  <div class="tabs parts-tabs">
    {% for block in section.blocks %}
      {% if block.type == 'tab' %}
        <a href="{{ block.settings.url }}" class="tab {% if block.settings.active %}active{% endif %}">
          {{ block.settings.text }}
        </a>
      {% endif %}
    {% endfor %}
  </div>

  <!-- CUSTOM SORT DROPDOWN -->
  <div class="sort-dropdown">
    <div class="custom-sort">
      <div class="custom-sort-selected">Sort by</div>
      <ul class="custom-sort-options">
        <li data-value="">Sort by</li>
        <li data-value="name-asc">Name, A–Z</li>
        <li data-value="name-desc">Name, Z–A</li>
        <li data-value="price-asc">Price, Low to High</li>
        <li data-value="price-desc">Price, High to Low</li>
      </ul>
    </div>
  </div>
</div>

<!-- Mobile / Tablet -->
<div class="top-bar-filter mobile-tablet-filters">
  <div class="dropdwn">
    <div class="custom-sort">
      <div class="custom-sort-selected">Sort by</div>
      <ul class="custom-sort-options">
        <li data-value="">Sort by</li>
        <li data-value="name-asc">Name, A–Z</li>
        <li data-value="name-desc">Name, Z–A</li>
        <li data-value="price-asc">Price, Low to High</li>
        <li data-value="price-desc">Price, High to Low</li>
      </ul>
    </div>
  </div>
</div>

<div class="border-lines"></div>

{% if collection and collection.products.size > 0 %}
{% paginate collection.products by 1000 %}
{% assign products = collection.products %}

<div class="main_section_all parts_collections arts">

<!-- DEFAULT -->
<div class="product-grid" id="sort-default">
  <div class="full-width-cards">
    {% for product in products %}
      {% include 'product-card', product: product %}
    {% endfor %}
  </div>
</div>

<!-- PRICE ASC -->
<div class="product-grid" id="sort-price-asc" style="display:none;">
  <div class="full-width-cards">
    {% assign sorted_price_asc = products | sort: 'price' %}
    {% for product in sorted_price_asc %}
      {% include 'product-card', product: product %}
    {% endfor %}
  </div>
</div>

<!-- PRICE DESC -->
<div class="product-grid" id="sort-price-desc" style="display:none;">
  <div class="full-width-cards">
    {% assign sorted_price_desc = products | sort: 'price' | reverse %}
    {% for product in sorted_price_desc %}
      {% include 'product-card', product: product %}
    {% endfor %}
  </div>
</div>

<!-- NAME ASC -->
<div class="product-grid" id="sort-name-asc" style="display:none;">
  <div class="full-width-cards">
    {% assign sorted_name_asc = products | sort: 'title' %}
    {% for product in sorted_name_asc %}
      {% include 'product-card', product: product %}
    {% endfor %}
  </div>
</div>

<!-- NAME DESC -->
<div class="product-grid" id="sort-name-desc" style="display:none;">
  <div class="full-width-cards">
    {% assign sorted_name_desc = products | sort: 'title' | reverse %}
    {% for product in sorted_name_desc %}
      {% include 'product-card', product: product %}
    {% endfor %}
  </div>
</div>

</div>

<div class="border-lines"></div>
<div class="results-count">
  Showing {{ products.size }} of {{ products.size }} results
</div>
<div class="border-lines"></div>

{% endpaginate %}
{% else %}
<p>No products found in this collection.</p>
{% endif %}

</div>
</div>

<!-- ================= STYLES ================= -->
<style>
.custom-sort {
  position: relative;
  width: 230px;
  font-family: 'Eczar';
}

.custom-sort-selected {
  height: 40px;
  background: #cfd8c0;
  border: 3px solid #628952;
  color: #628952;
  font-size: 20px;
  padding: 6px 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.custom-sort-selected::after {
  content: '';
  width: 12px;
  height: 8px;
  background: url(https://cdn.shopify.com/s/files/1/0694/0314/8465/files/Vector_14_1.svg?v=1747910122)
    no-repeat center;
}

.custom-sort-options {
  display: none;
  position: absolute;
  top: 100%;
  width: 100%;
  background: #cfd8c0;
  border: 3px solid #628952;
  border-top: none;
  z-index: 999;
  list-style: none;
  padding: 0;
  margin: 0;
}

.custom-sort-options li {
  padding: 10px 12px;
  cursor: pointer;
  color: #628952;
  font-size: 18px;
}

.custom-sort-options li:hover {
  background: #628952;
  color: #ffffff;
}
</style>

<!-- ================= CARD FLIP SCRIPT ================= -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const flipToBackButtons = document.querySelectorAll('.badge.lefts a');
  const flipToFrontButtons = document.querySelectorAll('.badge.rights a');

  flipToBackButtons.forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      if (window.innerWidth <= 767) {
        const card = this.closest('.card');
        card.classList.remove('frontflipped');
        card.classList.add('flipped');
      }
    });
  });

  flipToFrontButtons.forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      if (window.innerWidth <= 767) {
        const card = this.closest('.card');
        card.classList.remove('flipped');
        card.classList.add('frontflipped');
      }
    });
  });
});
</script>

<!-- ================= SORT SCRIPT ================= -->
<script>
document.addEventListener('DOMContentLoaded', function () {

  document.querySelectorAll('.custom-sort').forEach(dropdown => {

    const selected = dropdown.querySelector('.custom-sort-selected');
    const options = dropdown.querySelector('.custom-sort-options');
    const items = dropdown.querySelectorAll('li');

    function updateSortView(value) {
      const grids = [
        'sort-default',
        'sort-price-asc',
        'sort-price-desc',
        'sort-name-asc',
        'sort-name-desc'
      ];

      grids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });

      switch (value) {
        case 'price-asc':
          document.getElementById('sort-price-asc').style.display = 'block';
          break;
        case 'price-desc':
          document.getElementById('sort-price-desc').style.display = 'block';
          break;
        case 'name-asc':
          document.getElementById('sort-name-asc').style.display = 'block';
          break;
        case 'name-desc':
          document.getElementById('sort-name-desc').style.display = 'block';
          break;
        default:
          document.getElementById('sort-default').style.display = 'block';
      }
    }

    selected.addEventListener('click', () => {
      options.style.display = options.style.display === 'block' ? 'none' : 'block';
    });

    items.forEach(item => {
      item.addEventListener('click', () => {
        selected.textContent = item.textContent;
        options.style.display = 'none';
        updateSortView(item.dataset.value);
      });
    });

    document.addEventListener('click', e => {
      if (!dropdown.contains(e.target)) {
        options.style.display = 'none';
      }
    });

    updateSortView('');
  });

});
</script>
