{% schema %}
{
  "name": "Enquire Popup",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "text",
      "id": "recipient_email",
      "label": "Send enquiries to (email)"
    }
  ],
  "presets": [
    {
      "name": "Enquire Popup"
    }
  ]
}
{% endschema %}



{% stylesheet %}
.enquire-popup-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(34, 58, 18, 0.9);
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.enquire-popup {
  background-color: #fef9e7;
  padding: 40px;
  border-radius: 0px;
  width: 550px;
  max-width: 90%;
  position: relative;
  text-align: center;
  border: 5px solid #6B8D50;
}
.enquire-close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  background: transparent;
  border: none;
  font-size: 28px;
  cursor: pointer;
}
.enquire-title {
font-size: 132px;
    font-weight: 700;
    color: #6B8D50;
    font-family: 'VVDS Fifties';
    margin-bottom: 30px;
    margin: 0px;
}
.enquire-input,
.enquire-textarea {
  width: 100%;
  padding: 12px;
  margin-bottom: 20px;
  border: 2px solid #4b6226;
  background: #fffaf0;
  font-family: serif;
}
.enquire-textarea {
  height: 100px;
  resize: none;
}
.enquire-buttons {
  display: flex;
  justify-content: space-between;
}
.enquire-submit,
.enquire-cancel {
  padding: 12px 24px;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  font-family: serif;
}
.enquire-submit {
  background-color: #a75a00;
  color: white;
}
.enquire-cancel {
  background-color: #e5c07b;
  color: white;
}
{% endstylesheet %}


<div>
  <!-- Trigger Button -->
  <button id="openEnquirePopup" style="padding: 10px 20px; background-color: green; color: white;">
    Enquire
  </button>

  <!-- Popup -->
<div id="enquirePopup" class="enquire-popup-overlay"
  style="
    {% if section.settings.background_image != blank %}
      background-image: url('{{ section.settings.background_image | image_url }}');
      background-size: cover;
      background-position: center;
    {% else %}
      background-color: rgba(34, 58, 18, 0.9);
    {% endif %}
">    
    <div class="enquire-popup">
      <button class="enquire-close-btn" id="closePopupBtn">Ã—</button>
      <h2 class="enquire-title">ENQUIRE</h2>
      <form id="my-form" action="https://formspree.io/f/xovdbjak" method="POST">
      <input type="email" placeholder="Email" name="email" required class="enquire-input" />
      <textarea placeholder="Message" name="message" required class="enquire-textarea"></textarea>
      <button id="my-form-button">Submit</button>
      <p id="my-form-status"></p>
      </form>
    </div>
  </div>
</div>


{% javascript %}
function showPopup() {
  const popup = document.getElementById('enquirePopup');
  popup.style.display = 'flex';
}

function hidePopup() {
  const popup = document.getElementById('enquirePopup');
  popup.style.display = 'none';
}

document.addEventListener("DOMContentLoaded", function () {
  document.getElementById("openEnquirePopup").addEventListener("click", showPopup);
  document.getElementById("closePopupBtn").addEventListener("click", hidePopup);
  document.getElementById("cancelPopupBtn").addEventListener("click", hidePopup);
});



  var form = document.getElementById("my-form");
  
  async function handleSubmit(event) {
    event.preventDefault();
    var status = document.getElementById("my-form-status");
    var data = new FormData(event.target);
    fetch(event.target.action, {
      method: form.method,
      body: data,
      headers: {
          'Accept': 'application/json'
      }
    }).then(response => {
      if (response.ok) {
        status.innerHTML = "Thanks for your submission!";
        form.reset()
      } else {
        response.json().then(data => {
          if (Object.hasOwn(data, 'errors')) {
            status.innerHTML = data["errors"].map(error => error["message"]).join(", ")
          } else {
            status.innerHTML = "Oops! There was a problem submitting your form"
          }
        })
      }
    }).catch(error => {
      status.innerHTML = "Oops! There was a problem submitting your form"
    });
  }
  form.addEventListener("submit", handleSubmit)
  
{% endjavascript %}

